<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <script src="./three.min.js"></script>
        <script src="./photo-sphere-viewer.min.js"></script>
        <title>Document</title>
        <style>
            #mydiv {
                position: fixed;
                top: 50px;
                left: 50px;
                z-index: 9;
                text-align: center;
                border-radius: 5px;
                min-width: 150px;
            }

            #mydivheader {
                cursor: move;
                z-index: 10;
                background-color: #2196F3;
                color: #fff;
                border-radius: 5px 5px 0 0;
            }

            #video1 {
                border-radius: 0 0 5px 5px;
            }

            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #container {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <div id="virtual-human">
            <div id="mydiv">
                <div id="mydivheader">拖动<button onclick="closeVideo()" ontouchstart="closeVideo()"
                                                  style="margin-left: 10px;">关闭</button></div>

                <video id="video1" controls autoplay loop width="200" height="auto">
                    <source id="video-source"  type="video/mp4">
                    </source>
                </video>
            </div>
        </div>
        <div id="container"></div>

    </body>

    <script>
        // 获取微信小程序传过来的全景图地址
        var vrUrl = './b.jpg'
        var videoUrl = './虚拟人视频/大学生活动中心.mp4'
        getParamer()
        console.log('全景url:', vrUrl,"---视频url:", videoUrl)
        //获取并处理小程序传递过来的参数
        function getParamer() {
            var url = window.location.href.split("?")[1]; /*获取url里"?"后面的值*/
            if (url) {
                params =  url.split("&")
                vrUrl = params[0].split("=")[1]
                videoUrl = params[1].split("=")[1]
            }
        }
        document.getElementById("video-source").src = videoUrl



        var PSV = new PhotoSphereViewer({
            // Path to the panorama
            panorama: vrUrl, //这里放全景图地址

            // Container
            container: 'container'
        });

        // var PSV = new PhotoSphereViewer({
        //     // Path to the panorama
        //     panorama: 'http://hadoop102:9870/webhdfs/v1/vr/%E4%B8%9C%E7%8E%AF.jpg?op=OPEN', //这里放全景图地址

        //     // Container
        //     container: 'container'
        // });


        /*
            关闭视频窗口
        */
        function closeVideo() {
            document.getElementById("virtual-human").hidden = true;
        }

        /*
            悬浮窗设置
        */
        // 使元素 mydiv 可拖动:
        dragElement(document.getElementById("mydiv"));

        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            var threshold = 150; // 设置一个阈值，当悬浮窗离屏幕边缘小于这个值时，将其吸附到边缘

            if (document.getElementById(elmnt.id + "header")) {
                document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
                document.getElementById(elmnt.id + "header").ontouchstart = dragMouseDown;
            } else {
                elmnt.onmousedown = dragMouseDown;
                elmnt.ontouchstart = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.touches ? e.touches[0].clientX : e.clientX;
                pos4 = e.touches ? e.touches[0].clientY : e.clientY;
                document.onmouseup = closeDragElement;
                document.ontouchend = closeDragElement;
                document.onmousemove = elementDrag;
                document.ontouchmove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - (e.touches ? e.touches[0].clientX : e.clientX);
                pos2 = pos4 - (e.touches ? e.touches[0].clientY : e.clientY);
                pos3 = e.touches ? e.touches[0].clientX : e.clientX;
                pos4 = e.touches ? e.touches[0].clientY : e.clientY;
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // 停止移动时释放鼠标和触摸:
                document.onmouseup = null;
                document.ontouchend = null;
                document.onmousemove = null;
                document.ontouchmove = null;

                // 检查悬浮窗是否靠近屏幕边缘，并执行回弹和吸附
                var rect = elmnt.getBoundingClientRect();
                if (rect.left < threshold) {
                    // 吸附到左边缘
                    elmnt.style.left = "0px";
                } else if (rect.right > window.innerWidth - threshold) {
                    // 吸附到右边缘
                    elmnt.style.left = (window.innerWidth - rect.width) + "px";
                }

                if (rect.top < threshold) {
                    // 吸附到顶部边缘
                    elmnt.style.top = "0px";
                } else if (rect.bottom > window.innerHeight - threshold) {
                    // 吸附到底部边缘
                    elmnt.style.top = (window.innerHeight - rect.height) + "px";
                }
            }
        }


    </script>

</html>